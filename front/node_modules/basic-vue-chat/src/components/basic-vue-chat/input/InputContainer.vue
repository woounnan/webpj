<template>
  <div class="input__container">
    <img
      v-show="file"
      :src="imagePreview"
      class="image--uploaded">
    <slot name="input-field">
      <input-field
        v-model="message"
        @newOwnMessage="onNewOwnMessage" />
    </slot>
    <div class="features__container">
      <div class="input-images-upload">
        <div
          id="image"
          ref="image"
          type="file"
          class="image"
          accept="image/*"
          @change="handleFileUpload()">
          <label for="image">
            <font-awesome-icon icon="paperclip" />
          </label>
        </div>
      </div>
      <div class="input-images-upload input-emoji-picker__icon">
        <div
          id="emoji"
          @click="openEmojiPicker">
          <label for="emoji">
            <font-awesome-icon icon="smile" />
          </label>
        </div>
      </div>
      <div
        :class="{ visible: !toggleEmojiPicker }"
        class="input-emoji-picker__container">
        <picker
          :show-preview="false"
          :show-skin-tones="false"
          :show-categories="false"
          :show-search="false"
          native
          @select="emojiPicked" />
      </div>
      <slot name="features" />
      <v-menu top offset-y>
        <template v-slot:activator="{ on }">
          <v-icon v-on="on">control_point</v-icon>&nbsp;
        </template>
        <v-btn>
            <v-icon @click="regWork">work</v-icon>
            <v-icon @click="regNotice">notification_important</v-icon> 
        </v-btn>
      </v-menu>
    </div>
    <slot name="input-button">
      <input-button @newOwnMessage="onNewOwnMessage" />
    </slot>
  </div>
  <modals-container/>
</template>

<script>
import InputField from './InputField.vue'
import InputButton from './InputButton.vue'
import { Picker } from 'emoji-mart-vue'
import Work from './Work.vue'

export default {
  name: 'InputContainer',
  components: {
    InputField,
    InputButton,
    Picker,
    Work
  },
  props: {
    toggleEmojiPicker: {
      type: Boolean,
      default: false,
      required: false
    }
  },
  data: function () {
    return {
      message: '',
      file: undefined,
      imagePreview: ''
    }
  },
  methods: {
    regWork(){
      console.log('call regWork')
      this.$modal.show(Work,
          {
            //bus : this.ps.bus,
            modal : this.$modal,
          },
          {
            name: 'dynamic-modal',
            width: '100%',
            height: '100%',
            draggable: true
          }
        )
      console.log(this.$modal)
    },
    regNotice(){
      console.log('call regNotice')

    },
    onNewOwnMessage () {
      if ((!this.message || this.message === '') && !this.file) {
        return
      }
      var tempWorks = ''
      this.$emit('newOwnMessage', this.message, this.file, this.imagePreview, tempWorks)

      this.message = ''

      this.file = undefined

      this.imagePreview = ''
    },
    handleFileUpload () {
      this.file = this.$refs.image.files[0]
      let reader = new FileReader()

      reader.addEventListener(
        'load',
        function () {
          this.imagePreview = reader.result
        }.bind(this),
        false
      )

      if (this.file) {
        if (/\.(jpe?g|png|gif)$/i.test(this.file.name)) {
          reader.readAsDataURL(this.file)
        }
      }
    },
    openEmojiPicker () {
      this.$emit('openEmojiPicker', true)
    },
    emojiPicked (emoji) {
      this.message += emoji.native
    }
  }
}
</script>

<style lang="scss" scoped>
.visible {
  display: none;
}
</style>
